pico-8 cartridge // http://www.pico-8.com
version 8
__lua__
-- space-8
-- by ladybenko


-- consts and globals
ship_speed=4
bullet_speed=6
alien_speedx=2
alien_speedy=3

alien_anim={2,3}
boom_cols={7,8,9,10,2,1}

s_play=0
s_gameover=1
state=s_play

function draw_spr(s)
	spr(s.key,s.x-4,s.y-4)
end

function write(text,x,y,col)
 print(text,x+1,y+1,0)
 print(text,x,y,col)
end

function wrath_of_god()
	ship={}
	bullets={}
	aliens={}
	booms={}
	
	state=s_play
end

function start_game()
	score=0
	spawn_ship()
end

function spawn_ship()
	ship.x=64
	ship.y=120
	ship.key=0
	ship.width=8
	ship.height=8
end

function spawn_boom(x,y,size,coli)
 local b={}
 b.x=x b.y=y b.size=size
 b.coli=coli --color index
 b.time=0
 
 add(booms,b)
end

function explode(x,y)
 spawn_boom(x+2,y+2,6,5)
 spawn_boom(x+1,y+1,4,3)
 spawn_boom(x-1,y-1,3,4)
 spawn_boom(x,y,2,1)
end

function spawn_bullet(x,y)
 local b={} b.x=x b.y=y b.key=1
 b.width=4 b.height=6
 add(bullets,b)
end

function spawn_alien()
 local a={}
 
 a.x=flr(rnd(128))
 a.y=4
 a.speedx=-alien_speedx+flr(rnd(alien_speedx*2))
 a.speedy=flr(rnd(alien_speedy))+1
 a.curani=alien_anim
 a.anitime=0
 a.frame=0
 a.key=a.curani[1]
 a.width=8
 a.height=8
 
 add(aliens,a)
end

function collision(s1,s2)
 local x1=s1.x-s1.width/2
 local x2=s2.x-s2.width/2
 local y1=s1.y-s1.height/2
 local y2=s2.y-s2.height/2
 
 return 
 	(abs(x1-x2)*2 < s1.width+s2.width)
 	and
 	(abs(y1-y2)*2 < s1.height+s2.height)
end

function _init()
 music(0,0,1)
	wrath_of_god()
	start_game()
end

function _update()
 if state==s_play then
 	update_play()
 else
  update_gameover()
 end
end

function update_gameover()
 if btnp(4) then
 	wrath_of_god()
 	start_game()
 end
end

function update_play()

 -- update ship
	if (btn(0)) ship.x-=ship_speed
	if (btn(1)) ship.x+=ship_speed
	if (ship.x>124) ship.x=124
	if (ship.x<4) ship.x=4
	
	-- shoot
	if (btnp(4)) then
	 spawn_bullet(ship.x,ship.y-2)
	 sfx(0)
	end
	
	-- update bullets
	for b in all(bullets) do
		b.y-=bullet_speed
		if (b.y<-4) del(bullets,b)
	end
	
	-- update alien
	for a in all(aliens) do
	 -- move alien
	 a.x+=a.speedx
	 a.y+=a.speedy
	 if (a.y>132) del(aliens,a)
		-- animate alien
		a.anitime+=0.2
		if a.anitime>=1 then
			a.anitime-=1
			a.frame = (a.frame+1) % count(a.curani)
			a.key=a.curani[a.frame+1]
		end
	end
	
	-- update explosions
	for b in all(booms) do
		b.time+=0.5
		if(b.time>=1) then
		 b.time-=1
		 b.coli+=1
		 if b.coli>count(boom_cols) then
		  del(booms,b)
		 end
		end
	end
	
	-- randomly spawn aliens
	if rnd(100) < 15 then
	 spawn_alien()
	end
	
	-- check for collisions
	-- bullets vs aliens
	for a in all(aliens) do
	 for b in all(bullets) do
	 	if collision(a,b) then
	 	 del(aliens,a)
	 	 del(bullets,b)
	 	 sfx(1)
	 	 score+=5
	 	 explode(b.x,b.y)
	 	end
	 end
	end
	-- check for collisions
	-- ship vs aliens
	for a in all(aliens) do
		if collision(a,ship) then
		  sfx(1)
		  state=s_gameover
		end
	end
end

function _draw()
 rectfill(0,0,127,127,1)
 
 -- draw bg
 map(0,0,0,0,16,16)
 
 for b in all(booms) do
 	circfill(b.x,b.y,b.size,boom_cols[b.coli])
 end
	foreach(bullets,draw_spr)
	foreach(aliens,draw_spr)
	draw_spr(ship)
	
	write(score,2,2,7)
	
	if (state==s_gameover) then
	 write("game over",8,50,7)
	 write("press <action> to continue",8,60,7)
	end 
end

__gfx__
00077000000000000080080000800800111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
00677600000770000888888008888880111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
006dd600000aa0008888888888888888111111d11111111111d11111111111110000000000000000000000000000000000000000000000000000000000000000
07dddd70000bb000811881188118811811111111111111111111111111111d110000000000000000000000000000000000000000000000000000000000000000
776dd677000bb0008228822882288228111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
77766777000bb000888888888888888811111d111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
77666677000330000822228008822880111111111111111111111111611111110000000000000000000000000000000000000000000000000000000000000000
77000077000000008000000800800800111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000111111111111111111111111d11111110000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000111111111111161111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000011111111111111111111d111111111110000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000001111111d111111111111111111111d110000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
__label__
11111111111111111111111111111111111111111111111111111111111111111111111111111122211111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111111111111111122222a111111111111111111111111111111111111111111111
117711777177761111111111111111111111111111111111111111d1111111111111111111112228882aa1111111111111111111111111111111111111111111
11170110707000111111111111111111111111111111111111111111111111111111111111112288888aa111111111111111111111111d111111111111111111
11170887707771111111111111111111111111111111111111111111111111111111111111112288888aaa111111111111111111111111111111111111111111
11870888701070111111111111111111111111111111111111111d11111111111111111111111288888aaa111111111111111111111111111111111111111111
11777877707770111111111111111111111111111111111111111111111111111111111111111a2888aaaa111111111111111111611111111111111111111111
118000800010001111111111111111111111111111111111111111111111111111111111111111aaaaaaa8118111111111111111111111111111111111111111
118888888811111111111111111111111111111111111111111111111111111111111111111111aaaaaa88888811111111111111111111111111111111111111
11182222811111181181111111111111d111111111111111d1111111111111111111111111111111aaa888888881111111111111111111111111111111111111
11811111181111888888111111111111111111111111111111111111111111111111111111111611111811881181111111d11111111111111111111111111111
11111111111118888888811111111111111111111111111111111111111111111111111111111111111822882281111111111111111111111111111111111111
11111111111118118811811111111111111111111111111111111111111111111111111111111111111888888881111111111111111111111111111111111111
11111111111118228822811111111111111111111111111111111111111111111111111111111111111188228811111111111111111111111111111111111111
1111111111111888888881111111111111111d111111111111111d111111111111111111111111111111181181111111111111111111111d1111111111111111
11111111111111882288111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111181181111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111116111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111d1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111d111111111111111111111111111111111111111
11111111111111111111111111111111111111d11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111d11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111d111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
611111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111d8118111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888811111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111888888881111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111d1111111111111111111811881181111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111822882281111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111888888881111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111182222811111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111811111181111111111111111111111111111
1111111111111111111111111111111111111111111111111111111d111111111111111111111d11111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111d111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111d1111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111d11111111111111111111111111111d1111111111111111111111111111111111111111118118111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188888811111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111888888881111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111d111111111111181188118111111111111111111d111111111111111
11111111111111111111111111111111111111111111111111111111111111111111161111111111111111822882281111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111888888881111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111188228811111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111118118111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111d111111111111111111111111111111111111111d1111181181
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111888888
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118888888
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118118811
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118228822
11111111111111111111111111111d11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118888888
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111882288
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111181181
111111111111111111111111611111111111111111111111111111111111111d1111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111161111111111111111111111111111111111111111111111111111d111111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111d1111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111116111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111d111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111116111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111d1111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111d1111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111d111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111d11111111111111111111111161111111111111111111111d11111111111111111111111111111111111111111111111111111111111111111111111d
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111d11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111d
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111611111111111111111111d111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111811811111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118888881111111111
11111111111111111111111111111811811111111111111d1111111111111111111111111111111111111111111111111111111111111118888888811111111d
11111111111111111111111111118888881111111111111111111111111111111111111111111111111111111111111111111111111111181188118111111111
11111111111111111111111111188888888111111111111111111111111111111111111111111111111111111111111111111111111111182288228111111111
11111111111111111111111111181188118111111111111111111111111111111111111111111111111111111111111111111111111111188888888111111111
11111111111111111111111111182288228111111111111111111111111111111111111111111111111111111111111111111111111111118822881111111111
11111111111111111111111111188888888111111111111111111111111111111111111111111111111111111111111111111111111111111811811111111111
11111111111111111111111111118222281111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111181111118111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111d111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111611111111111111111111111111111111111111111111111111111111111111111111d11111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111117711111111111111111111111111111111111111111111111
111111111111d1111111111111111111111111111111111111111111111111111111111111111167761111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111111111111111116dd61111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111111117dddd7111111111111111111111111111111111111111111111
1111111111111111111111111111111111111111111111111111111111111111111111111111776dd67711111111111111111111111111111111111111111111
111111111111111111111111d1111111111111111111111111111111111111111111111111117776677711111111111111111111111111111111111111111111
111111d111d111111111111111111111111116111111111111111111111111111111111111117766667711111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111117711117711111111111111111111111111111111111111111181
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111888
11111d11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118888
11111111111111111111111111111d11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118118
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111118228

__map__
0515050505050405050505050507050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050517051705051505050614050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0514050505050505050505050515050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0705050504050505050505170505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505051405051705050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0514050505170505050505070505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050505050505151705050505170500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0505050705050514050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15050505050505060708090a0b0c0d0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05050505150505161718191a1b1c1d0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
14050505070514262728292a2b2c2d1400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05050506050505363738393a3b3c3d1400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05150505061405464748494a4b4c4d1400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05050514050505565758595a5b5c5d0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05160505050515666768696a6b6c6d0600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04060517150505767778797a7b7c7d0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000600002a17032170371700610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600001737010370093702430000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01190000180601c060000001f0601f0600000018060000002106021060150071f0600000018060150071c0621d0601d0001f060000002106021060230021f060210601f060180700d0701c060000001806000000
011000070c0000c002130050c002000000c0020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 02444344

